/*!
 * fingerd.min.js v0.0.24
 * (c) 2017 HcySunYang
 * Released under the MIT License.
 */!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.Fingerd=i()}(this,function(){"use strict";function t(t){return Array.isArray(t)?t:Array.prototype.slice.call(t)}function i(){return Date.now()}function e(t){for(var i=[],e=arguments.length-1;e-- >0;)i[e]=arguments[e+1];return i.forEach(function(i){for(var e in i)t[e]=i[e]}),t}function n(t,i){var e=t.compareDocumentPosition(i);return 0===e||20===e}function s(t){var i=t.map(function(t){return Math.abs(t)});return t[i.indexOf(Math.max.apply(null,i))]}function r(t,i,e){var s=document.elementFromPoint(i,e);return!!s&&n(t,s)}function h(t,i){return 0===i?0:-i/t*4}function o(t,i){return 0===i?0:i*i/(-2*t)}function c(t,i){var e=t.x-i.x,n=t.y-i.y;return Math.sqrt(e*e+n*n)}function a(i,e){return void 0!==e?i.touches[e]||{}:t(i.touches)}function u(i,e){return void 0!==e?i.changedTouches[e]||{}:t(i.changedTouches)}var f=0,g=function(t){this.id=f++,this._init(t)};g.prototype._init=function(t){var i=e({element:null,transTime:3e3},t);this.element=i.element,this.native=null,this.startTime=this.startX=this.startY=this.distanceX=this.distanceY=this.lastX=this.lastY=this.lastTime=this.xv=this.yv=this.xs=this.ys=this.xt=this.yt=this.xa=this.ya=this.transDistanceX=this.transDistanceY=0,this.transTime=i.transTime,this.direction={top:!1,bottom:!1,left:!1,right:!1,topLeft:!1,topRight:!1,bottomLeft:!1,bottomRight:!1},this.fingerInElement=!1,this.isMoveOut=!1,this.velocityQueueX=[],this.velocityQueueY=[]},g.prototype.start=function(t){this.element&&(this.fingerInElement=r(this.element,t.pageX,t.pageY)),this.native=t,this.isMoveOut=!1,this.lastX=this.startX=t.pageX,this.lastY=this.startY=t.pageY,this.startTime=this.lastTime=i()},g.prototype.move=function(t){if(this.element&&(this.fingerInElement=r(this.element,t.pageX,t.pageY),!this.fingerInElement))return this.isMoveOut||(this.end(t),this.isMoveOut=!0),!1;this.native=t,this.distanceX=t.pageX-this.startX,this.distanceY=t.pageY-this.startY,this.xs=t.pageX-this.lastX,this.lastX=t.pageX,this.ys=t.pageY-this.lastY,this.lastY=t.pageY,this.checkDirection();var e=i();this.xt=this.yt=e-this.lastTime||15,this.lastTime=e,this.xv=this.xs/this.xt,this.yv=this.ys/this.yt,this.velocityBufferQueue(),this.xv=s(this.velocityQueueX),this.yv=s(this.velocityQueueY),this.xa=h(this.transTime,this.xv),this.ya=h(this.transTime,this.yv)},g.prototype.end=function(t){this.element&&(this.fingerInElement=r(this.element,t.pageX,t.pageY)),this.native=t,this.transDistanceX=o(this.xa,this.xv),this.transDistanceY=o(this.ya,this.yv)},g.prototype.velocityBufferQueue=function(){this.velocityQueueX.length>1&&this.velocityQueueX.shift(),this.velocityQueueY.length>1&&this.velocityQueueY.shift(),this.velocityQueueX.push(this.xv),this.velocityQueueY.push(this.yv)},g.prototype.checkDirection=function(){this.xs<0&&(this.direction.left=!0,this.direction.right=!1),0===this.xs&&(this.direction.left=!1,this.direction.right=!1),this.xs>0&&(this.direction.left=!1,this.direction.right=!0),this.ys<0&&(this.direction.top=!0,this.direction.bottom=!1),0===this.ys&&(this.direction.top=!1,this.direction.bottom=!1),this.ys>0&&(this.direction.top=!1,this.direction.bottom=!0),this.direction.topLeft=this.direction.top&&this.direction.left,this.direction.topRight=this.direction.top&&this.direction.right,this.direction.bottomLeft=this.direction.bottom&&this.direction.left,this.direction.bottomRight=this.direction.bottom&&this.direction.right},g.prototype.takeover=function(t){var e=t;this.distanceX=e.distanceX,this.distanceY=e.distanceY,this.startX=this.lastX-this.distanceX,this.startY=this.lastY-this.distanceY,this.lastTime=i()};var l={touchstart:"touchstart",touchmove:"touchmove",touchend:"touchend",touchcancel:"touchcancel"},v=function(t){this.options=e({element:null,transTime:3e3},t),this.fingers=[],this.changeFingerIndex=0,this.fingerNumber=0};return v.prototype.injectEvent=function(t){var i=this,e=t.type,n=(a(t),u(t));if(e===l.touchstart)for(var s=n.length,r=0;r<s;r++){var h=n[r].identifier,o=new g(i.options);o.start(n[r]),0===i.fingerNumber&&(i.fingers.length=0),i.fingers.push(o);var c=i.getFingerById(i.fingers,h),f=(c.finger,c.pos);i.fingerNumber=i.fingers.length,i.changeFingerIndex=f}if(e===l.touchmove)for(var v=n.length,p=0;p<v;p++){var d=n[p].identifier,m=i.getFingerById(i.fingers,d),y=m.finger,x=m.pos;if(!y.fingerInElement)return i;i.fingerNumber=i.fingers.length,i.changeFingerIndex=x,y.move(n[p]),y.fingerInElement||i.forceRemove(m,n[p])}if(e===l.touchend||e===l.touchcancel){if(this.fingerNumber>=5&&e===l.touchcancel)return this.fingerNumber=0,this.fingers.length=0,this;for(var X=n.length,Y=0;Y<X;Y++){var b=n[Y].identifier,I=i.getFingerById(i.fingers,b);if(!I.finger.fingerInElement)return i;i.forceRemove(I,n[Y])}}return this},v.prototype.getFingerPicth=function(t,i){return c({x:t.native.clientX,y:t.native.clientY},{x:i.native.clientX,y:i.native.clientY})},v.prototype.getScale=function(t,i){var e={x:t.startX,y:t.startY},n={x:i.startX,y:i.startY},s=c(e,n);return this.getFingerPicth(t,i)/s},v.prototype.getFingerById=function(t,i){for(var e=null,n=0,s=t.length,r=0;r<s;r++)if(t[r].native.identifier===i){e=t[r],n=r;break}return{finger:e,pos:n}},v.prototype.forceRemove=function(t,i){var e=t.finger,n=t.pos,s=this.fingers[n+1],r=this.fingers[n-1];this.changeFingerIndex=n,e.end(i),s?(s.takeover(e),this.fingers.splice(n,1),this.fingerNumber=this.fingers.length):r?(this.fingers.splice(n,1),this.fingerNumber=this.fingers.length):this.fingerNumber--},v});