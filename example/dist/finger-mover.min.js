/*!
 * finger-mover.min.js v1.0.2
 * (c) 2017 HcySunYang
 * Released under the MIT License.
 */!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Fmover=e()}(this,function(){"use strict";function t(t){throw new TypeError(t)}function e(t){return Array.isArray(t)?t:Array.prototype.slice.call(t)}function i(t,e){return document.defaultView.getComputedStyle(t,null)[e]}function n(){return Date.now()}function s(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];return e.forEach(function(e){for(var i in e)t[i]=e[i]}),t}function r(t,e){t.style.cssText=t.style.cssText+" "+e}function o(t,e){for(var i={top:0,left:0};e!==t;)i.top+=e.offsetTop,i.left+=e.offsetLeft,e=e.offsetParent;return i}function a(t,e){var i=t.compareDocumentPosition(e);return 0===i||20===i}function h(t){var e=i(t,"WebkitTransform");return"none"!==e&&e.match(/[+-]?\d*[.]?\d+(?=,|\))/g).length>6}function c(t,e,i){var n="";t.transform=t.transform?t.transform:Object.create(null),t.transform[e]=i;for(var s in t.transform)switch(s){case"translateX":case"translateY":case"translateZ":n+=s+"("+t.transform[s]+"px) ";break;case"scaleX":case"scaleY":case"scaleZ":n+=s+"("+t.transform[s]+") ";break;case"rotateX":case"rotateY":case"rotateZ":case"skewX":case"skewY":n+=s+"("+t.transform[s]+"deg) "}r(t,"transform: "+n+"; -webkit-transform: "+n+";")}function u(t){var e=i(t,"WebkitTransform");e&&"none"!==e||c(t,"translateZ",.01),e=i(t,"WebkitTransform").match(/[+-]?\d*[.]?\d+(?=,|\))/g).map(function(t){return parseInt(t)});var n=e.length,s={},r=n>6;return s.translateX=r?e[12]:e[4],s.translateY=r?e[13]:e[5],s.translateZ=r?e[14]:0,s.scaleX=void 0!==t.transform.scaleX?t.transform.scaleX:1,s.scaleY=void 0!==t.transform.scaleY?t.transform.scaleY:1,s.scaleZ=void 0!==t.transform.scaleZ?t.transform.scaleZ:1,s.rotateX=void 0!==t.transform.rotateX?t.transform.rotateX:0,s.rotateY=void 0!==t.transform.rotateY?t.transform.rotateY:0,s.rotateZ=void 0!==t.transform.rotateZ?t.transform.rotateZ:0,s.skewX=void 0!==t.transform.skewX?t.transform.skewX:0,s.skewY=void 0!==t.transform.skewY?t.transform.skewY:0,s}function l(t){var e=t.map(function(t){return Math.abs(t)});return t[e.indexOf(Math.max.apply(null,e))]}function f(t,e,i){var n=document.elementFromPoint(e,i);return!!n&&a(t,n)}function g(t,e){return 0===e?0:-e/t*4}function p(t,e){return 0===e?0:e*e/(-2*t)}function d(t,e){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)}function v(t,i){return void 0!==i?t.touches[i]||{}:e(t.touches)}function m(t,i){return void 0!==i?t.changedTouches[i]||{}:e(t.changedTouches)}var y=requestAnimationFrame||webkitRequestAnimationFrame,X=cancelAnimationFrame||webkitCancelAnimationFrame,Y={easeOutStrong:function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},backOut:function(t,e,i,n,s){return void 0===s&&(s=.7),i*((t=t/n-1)*t*((s+1)*t+s)+1)+e}},b=function(t){this.handle=t,this.id=0,this._init()};b.prototype._init=function(){this.start=n(),this.request()},b.prototype._fakeHandle=function(){var t=n()-this.start;this.handle(t)},b.prototype._requestAnimFn=function(t){return y?y(t):setTimeout(t,1e3/60)},b.prototype._cancelAnimFn=function(t){X?X(t):clearTimeout(t)},b.prototype.request=function(){this.id=this._requestAnimFn(this._fakeHandle.bind(this))},b.prototype.cancel=function(){this._cancelAnimFn(this.id)};var x={start:"start",stop:"stop"},k=0,S=function t(){this.moveStatus=x.stop,this.isArrivals=!1,this instanceof t||throwError("Moved is a constructor and should be called with the `new` keyword")};S.prototype.start=function(t){var e=this;if(this.moveStatus!==x.start){t=t||{};var i=t.el,n=t.target,s=t.type,r=t.time,o=t.endCallBack,a=t.inCallBack,h=t.s;this.isArrivals=!1,this.id=k++,this.el=i,this.target=n,this.type=s||"easeOutStrong",this.time=r<=1?1:r,this.endCallBack=o,this.inCallBack=a,this.currentPos={},this.moveStatus=x.stop,this.b={},this.c={},this.d=this.time,this.s=h;for(var c in e.target)e.b[c]=u(e.el)[c],e.c[c]=e.target[c]-e.b[c],0===e.c[c]&&(e.isArrivals=!0);if(this.isArrivals)return this.endCallBack&&this.endCallBack(this.b),!1;this.anim=new b(this._moveHandle.bind(this))}},S.prototype.stop=function(t){var e=this;if(this.moveStatus===x.stop)return this;this.moveStatus=x.stop,this.anim.cancel();for(var i in e.target)c(e.el,i,e.currentPos[i]);return t&&t(this.currentPos),this},S.prototype.transform=function(t,e,i){c(t,e,i)},S.prototype.getPropFromMatrix=function(t){return u(t)},S.prototype._moveHandle=function(t){var e=this;t=t>=this.d?this.d:t;for(var i in e.target)e.currentPos[i]=S.Tween[e.type](t,e.b[i],e.c[i],e.d,e.s),c(e.el,i,e.currentPos[i]);this.moveStatus=x.start,this.inCallBack&&this.inCallBack.call(this,this.currentPos),t>=this.d?this.stop(this.endCallBack):this.anim.request()},S.Tween=Y;var w=0,T=function(t){this.id=w++,this._init(t)};T.prototype._init=function(t){var e=s({element:null,transTime:3e3},t);this.element=e.element,this.native=null,this.startTime=this.startX=this.startY=this.distanceX=this.distanceY=this.lastX=this.lastY=this.lastTime=this.xv=this.yv=this.xs=this.ys=this.xt=this.yt=this.xa=this.ya=this.transDistanceX=this.transDistanceY=0,this.transTime=e.transTime,this.direction={top:!1,bottom:!1,left:!1,right:!1,topLeft:!1,topRight:!1,bottomLeft:!1,bottomRight:!1},this.fingerInElement=!1,this.isMoveOut=!1,this.velocityQueueX=[],this.velocityQueueY=[]},T.prototype.start=function(t){this.element&&(this.fingerInElement=f(this.element,t.pageX,t.pageY)),this.native=t,this.isMoveOut=!1,this.lastX=this.startX=t.pageX,this.lastY=this.startY=t.pageY,this.startTime=this.lastTime=n()},T.prototype.move=function(t){if(this.element&&(this.fingerInElement=f(this.element,t.pageX,t.pageY),!this.fingerInElement))return this.isMoveOut||(this.end(t),this.isMoveOut=!0),!1;this.native=t,this.distanceX=t.pageX-this.startX,this.distanceY=t.pageY-this.startY,this.xs=t.pageX-this.lastX,this.lastX=t.pageX,this.ys=t.pageY-this.lastY,this.lastY=t.pageY,this.checkDirection();var e=n();this.xt=this.yt=e-this.lastTime||15,this.lastTime=e,this.xv=this.xs/this.xt,this.yv=this.ys/this.yt,this.velocityBufferQueue(),this.xv=l(this.velocityQueueX),this.yv=l(this.velocityQueueY),this.xa=g(this.transTime,this.xv),this.ya=g(this.transTime,this.yv)},T.prototype.end=function(t){this.element&&(this.fingerInElement=f(this.element,t.pageX,t.pageY)),this.native=t,this.transDistanceX=p(this.xa,this.xv),this.transDistanceY=p(this.ya,this.yv)},T.prototype.velocityBufferQueue=function(){this.velocityQueueX.length>1&&this.velocityQueueX.shift(),this.velocityQueueY.length>1&&this.velocityQueueY.shift(),this.velocityQueueX.push(this.xv),this.velocityQueueY.push(this.yv)},T.prototype.checkDirection=function(){this.xs<0&&(this.direction.left=!0,this.direction.right=!1),0===this.xs&&(this.direction.left=!1,this.direction.right=!1),this.xs>0&&(this.direction.left=!1,this.direction.right=!0),this.ys<0&&(this.direction.top=!0,this.direction.bottom=!1),0===this.ys&&(this.direction.top=!1,this.direction.bottom=!1),this.ys>0&&(this.direction.top=!1,this.direction.bottom=!0),this.direction.topLeft=this.direction.top&&this.direction.left,this.direction.topRight=this.direction.top&&this.direction.right,this.direction.bottomLeft=this.direction.bottom&&this.direction.left,this.direction.bottomRight=this.direction.bottom&&this.direction.right},T.prototype.takeover=function(t){var e=t;this.distanceX=e.distanceX,this.distanceY=e.distanceY,this.startX=this.lastX-this.distanceX,this.startY=this.lastY-this.distanceY,this.lastTime=n()};var _={touchstart:"touchstart",touchmove:"touchmove",touchend:"touchend",touchcancel:"touchcancel"},E=function(t){this.options=s({element:null,transTime:3e3},t),this.fingers=[],this.changeFingerIndex=0,this.fingerNumber=0};E.prototype.injectEvent=function(t){var e=this,i=t.type,n=(v(t),m(t));if(i===_.touchstart)for(var s=n.length,r=0;r<s;r++){var o=n[r].identifier,a=new T(e.options);a.start(n[r]),0===e.fingerNumber&&(e.fingers.length=0),e.fingers.push(a);var h=e.getFingerById(e.fingers,o),c=(h.finger,h.pos);e.fingerNumber=e.fingers.length,e.changeFingerIndex=c}if(i===_.touchmove)for(var u=n.length,l=0;l<u;l++){var f=n[l].identifier,g=e.getFingerById(e.fingers,f),p=g.finger,d=g.pos;if(!p.fingerInElement)return e;e.fingerNumber=e.fingers.length,e.changeFingerIndex=d,p.move(n[l]),p.fingerInElement||e.forceRemove(g,n[l])}if(i===_.touchend||i===_.touchcancel){if(this.fingerNumber>=5&&i===_.touchcancel)return this.fingerNumber=0,this.fingers.length=0,this;for(var y=n.length,X=0;X<y;X++){var Y=n[X].identifier,b=e.getFingerById(e.fingers,Y);if(!b.finger.fingerInElement)return e;e.forceRemove(b,n[X])}}return this},E.prototype.getFingerPicth=function(t,e){return d({x:t.native.clientX,y:t.native.clientY},{x:e.native.clientX,y:e.native.clientY})},E.prototype.getScale=function(t,e){var i={x:t.startX,y:t.startY},n={x:e.startX,y:e.startY},s=d(i,n);return this.getFingerPicth(t,e)/s},E.prototype.getFingerById=function(t,e){for(var i=null,n=0,s=t.length,r=0;r<s;r++)if(t[r].native.identifier===e){i=t[r],n=r;break}return{finger:i,pos:n}},E.prototype.forceRemove=function(t,e){var i=t.finger,n=t.pos,s=this.fingers[n+1],r=this.fingers[n-1];this.changeFingerIndex=n,i.end(e),s?(s.takeover(i),this.fingers.splice(n,1),this.fingerNumber=this.fingers.length):r?(this.fingers.splice(n,1),this.fingerNumber=this.fingers.length):this.fingerNumber--};var F=function e(i){i=i||{},this instanceof e||t("Fmover is a constructor and should be called with the `new` keyword"),this._init(i)};return F.prototype._init=function(e){this.el=document.querySelector(e.el),this.el||t("This is an invalid selector: "+e.el),this.fingerd=new E({element:this.el}),this.plugins=e.plugins||[],this.pluginsStorage=[],this._initPlugins(),this._initStyle(),this._initEvents()},F.prototype._initPlugins=function(){for(var t=this,e=this.plugins.length,i=0;i<e;i++)t[i]=t.plugins[i](F),t.pluginsStorage.push(t[i]);for(var n=this.pluginsStorage.length,s=0;s<n;s++)t.pluginsStorage[s].init&&t.pluginsStorage[s].init(t)},F.prototype._initStyle=function(){h(this.el)||c(this.el,"translateZ",.01)},F.prototype._initEvents=function(){var t=this.el;t.addEventListener("touchstart",this._start.bind(this),!1),t.addEventListener("touchmove",this._move.bind(this),!1),t.addEventListener("touchend",this._end.bind(this),!1),t.addEventListener("touchcancel",this._cancel.bind(this),!1)},F.prototype._start=function(t){for(var e=this,i=this.fingerd.injectEvent(t),n=i.fingers.length,s=0;s<n;s++)i.fingers[s].el=e.el;for(var r=this.pluginsStorage.length,o=0;o<r;o++)e.pluginsStorage[o].start&&e.pluginsStorage[o].start(i);t.preventDefault()},F.prototype._move=function(t){for(var e,i=this,n=this.fingerd.injectEvent(t),s=this.pluginsStorage.length,r=0;r<s;r++)e=i.pluginsStorage[r].move&&i.pluginsStorage[r].move(n);void 0===e||e||t.stopPropagation(),t.preventDefault()},F.prototype._end=function(t){for(var e=this,i=this.fingerd.injectEvent(t),n=this.pluginsStorage.length,s=0;s<n;s++)e.pluginsStorage[s].end&&e.pluginsStorage[s].end(i);t.preventDefault()},F.prototype._cancel=function(t){for(var e=this,i=this.fingerd.injectEvent(t),n=this.pluginsStorage.length,s=0;s<n;s++)e.pluginsStorage[s].cancel&&e.pluginsStorage[s].cancel(i);t.preventDefault()},function(h){h.Moved=S,h.Fingerd=E,h.extend=s,h.now=n,h.getStyle=i,h.cssText=r,h.getPropFromMatrix=u,h.getRelativeRect=o,h.isInElement=a,h.throwError=t,h.toArray=e}(F),F});